<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div>
      <canvas id='gameCanvas' height="800" width='800'></canvas>
    </div>

    <div>
      <button type = "button" onClick = "startButtonHandler()"> Start/Pause </button>
      <button type = "button" onClick = "resetButtonHandler()"> Reset </button>
      <label for="gridSize"> Grid Size </label>
      <input type = "text" id = "gridsize" name = "gridSize">
    </div>


    <script>
      let gameOn = false;
      let canvas = document.getElementById("gameCanvas");
      let ctx = canvas.getContext("2d");
      let gridState = createBlankState(50);
      let gridSize = 50;
      gridState[26][24] = 1;
      gridState[26][26] = 1;
      gridState[26][25] = 1;

      canvas.addEventListener("click", function(e){canvasClicked(e)});


      //input is the size of the array
      function createBlankState (size){
        let result = new Array(size).fill(0).map(() => new Array(size).fill(0));
        return result;
      }

      //returns the next frame
      //should leave "state" unchanged
      function generateNewState(state, boardSize){
        let result = createBlankState (boardSize);
        for (let i = 0; i < boardSize; i++){
          for (let j = 0; j < boardSize; j++){
            if (
              state[i][j] === 0 &&
              countNeighbors(state, boardSize, i, j) === 3
            ){
              result[i][j] = 1;
            }

            if (
              state[i][j] === 1 &&
              (countNeighbors(state, boardSize, i, j) === 3 ||
              countNeighbors(state, boardSize, i, j) === 2)
            ){
              result[i][j] = 1;
            }
          }
        }
        return result;
      }

      function drawBoardFromState(state, boardSize){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < boardSize; i++){
          for (let j = 0; j < boardSize; j++){
            if (state[i][j]){
              ctx.beginPath();
              ctx.fillRect((i-1)*800/boardSize, (j-1)*800/boardSize, 800/boardSize, 800/boardSize);
              ctx.closePath();
            }else{
              ctx.beginPath();
              ctx.strokeRect((i-1)*800/boardSize, (j-1)*800/boardSize, 800/boardSize, 800/boardSize);
              ctx.closePath();
            }
          }
        }
      }

      function draw() {
        console.log("drawing");
        drawBoardFromState(gridState, gridSize);
      }

      // input is a board state and size, followed by the indices of the cell to check
      // boardState should be unaltered
      function countNeighbors(boardState, boardSize, i, j){
        let counter = 0;
        if (i-1 >= 0 && j-1 >= 0){
          if (boardState[i-1][j-1]){
            counter ++;
          }
        }
        if (j-1 >= 0){
          if (boardState[i][j-1]){
            counter ++;
          }
        }
        if (i+1 < boardSize && j-1 >= 0){
          if (boardState[i+1][j-1]){
            counter ++
          }
        }
        if (i+1 < boardSize){
          if (boardState[i+1][j]){
            counter ++
          }
        }
        if (i+1 < boardSize && j+1 < boardSize){
          if (boardState[i+1][j+1]){
            counter ++
          }
        }
        if (j+1 < boardSize){
          if (boardState[i][j+1]){
            counter ++
          }
        }
        if (i-1 >= 0 && j+1 < boardSize){
          if (boardState[i-1][j+1]){
            counter ++
          }
        }
        if (i-1 >= 0){
          if (boardState[i-1][j]){
            counter ++
          }
        }
        if (counter>2){
                  console.log(i + ", " + j + ", neighbors: " + counter);
        }
        return counter;
      }

      function startButtonHandler(){
        gameOn = !gameOn;
        gameLoop();
      }

      function resetButtonHandler(){
        gameOn = false;
        gridState = createBlankState(50);
      }

      function gameLoop(){
        if (gameOn === true){
          let newGridState = generateNewState(gridState, gridSize);
          gridState = newGridState;
          requestAnimationFrame(draw);
          setTimeout(function(){gameLoop()}, 1000);
        }
      }

      function canvasClicked(e){
        let rect = canvas.getBoundingClientRect();
        let x = e.pageX - rect.left;
        let y = e.pageY - rect.top;

      }
      requestAnimationFrame(draw);
    </script>
  </body>
</html>
